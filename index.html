        function calculateAll() {
            let bestPrice = Infinity;
            let winners = []; // เก็บ ID ของรายการที่ถูกที่สุด (รองรับกรณีเท่ากันหลายตัว)

            const cards = document.querySelectorAll('.product-card');
            
            // 1. หาราคาที่ถูกที่สุดก่อน
            cards.forEach(card => {
                const id = card.id.split('-')[1];
                const price = parseFloat(document.getElementById(`price-${id}`).value);
                const qty = parseFloat(document.getElementById(`qty-${id}`).value);
                
                card.classList.remove('best-card');
                document.getElementById(`unit-display-${id}`).classList.add('hidden');

                if (price > 0 && qty > 0) {
                    const unitPrice = parseFloat((price / qty).toFixed(4)); // ปัดเศษเพื่อเทียบกันได้แม่นยำ
                    document.getElementById(`unit-val-${id}`).innerText = unitPrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 4});
                    document.getElementById(`unit-display-${id}`).classList.remove('hidden');

                    if (unitPrice < bestPrice) {
                        bestPrice = unitPrice;
                    }
                }
            });

            // 2. ตรวจสอบว่ามีกี่รายการที่ราคาเท่ากับราคาที่ถูกที่สุด
            cards.forEach(card => {
                const id = card.id.split('-')[1];
                const price = parseFloat(document.getElementById(`price-${id}`).value);
                const qty = parseFloat(document.getElementById(`qty-${id}`).value);
                
                if (price > 0 && qty > 0) {
                    const unitPrice = parseFloat((price / qty).toFixed(4));
                    if (unitPrice === bestPrice) {
                        winners.push(id);
                    }
                }
            });

            // 3. แสดงผล
            if (winners.length > 0) {
                const finalResult = document.getElementById('final-result');
                const winnerName = document.getElementById('winner-name');
                const winnerPrice = document.getElementById('winner-price');
                const resultPanel = finalResult.firstElementChild;

                finalResult.classList.remove('hidden');
                winnerPrice.innerText = bestPrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 4});

                if (winners.length > 1) {
                    // กรณีมีตัวที่ราคาเท่ากัน
                    winners.forEach(id => document.getElementById(`card-${id}`).classList.add('best-card'));
                    winnerName.innerText = "มีรายการที่ราคาเท่ากัน!";
                    resultPanel.className = "bg-amber-500 text-white p-5 rounded-3xl shadow-xl text-center transition-all"; // เปลี่ยนเป็นสีส้มแจ้งเตือน
                } else {
                    // กรณีมีผู้ชนะตัวเดียว
                    document.getElementById(`card-${winners[0]}`).classList.add('best-card');
                    const name = document.getElementById(`name-${winners[0]}`).value || `สินค้าที่ ${winners[0]}`;
                    winnerName.innerText = name;
                    resultPanel.className = "bg-green-600 text-white p-5 rounded-3xl shadow-xl text-center transition-all"; // สีเขียวปกติ
                }
                
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }
        }
